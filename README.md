# 学生选课系统设计
## 关于实验报告
本次实验报告包含两种格式，分别为用LaTeX生成的pdf文档和用Markdown编写的文档。pdf文档方便打印成纸质报告后阅读，但是因为分页的原因不适合阅读代码片段；Markdown文档虽然不能打印，但是非常适合在电脑上阅读。
## 实验内容
设计一个学生选课系统，要求能够查看每个学生所选课程和每个课程选课学生。
## 设计思路
对于选课系统来说，最为重要的是学生选课的体验，因此首要目标是**将每次选课、查课等操作的用户等待时间降到最低**。很自然就想到了**查找的时间复杂度为O(1)的哈希表（散列表）**。
因为要能够分别快速查找课程以及学生的信息，所以选择**建立两个哈希表**。分别用于存放课程和学生之间的信息。
考虑实际情况，经常有不同老师授课的同名课程，学生之间重名现象时有发生，所以选择学生和课程的唯一标号作为哈希表的key。**学生哈希表的key是学生的一卡通号，课程哈希表的key是课程号**（虽然课程号可以非数字，但是为了偷懒设定课程号必须为纯数字）。
哈希表的**映射函数选择除数取余法**，采用**拉链法解决地址冲突**。
考虑到一卡通号和课程号没有符号信息，且二者所需的位数不超过9位，unsigned的存储范围已经包括九位十进制数，所以**key选择unsigned型**。
对于学生信息的哈希表结点，除了保存key外还要保存**学生姓名和学号**，二者均以字符串保存，因为不太了解字符串存储的优化的方法，所以直接以**std::string类**存储字符串。
对于课程信息的哈希表结点，除了保存key外还要保存课程名称、地点、时间、课容量。**名称、地点**也采用**std::string类**，**课容量**为**int型**。至于**时间的变量类型**，考虑以一节课为原子时间，一学期有13(节课每天) \* 7(天每周) \* 16 周，即使每节课是否占用的信息以1bit存储，存储一门课程的时间信息也需要占用182bytes，内存占用非常大。所以考虑**使用直接以字符串的形式保存时间数据**，std::string的占用内存于X64 Windows平台为40bytes，**需要使用时间数据时再解析为上述 13\*7\*16bits的形式**，大大减少了内存占用。
除去学生和课程各自的信息，还需要保存学生们选课的信息。一般来说很容易想到使用指针将课程结点和结生节点连接起来，但是因为该选课系统要求既能查看某个学生的选课，又能查看某个课程选课的所有学生，所以需要在课程和学生结点之间需要连接双向的指针，在x64程序内指针的占用为8bytes，而且每位学生可以选很多课，而门课程也能容纳很多学生，这无疑是一笔很大的开销。因此选择**使用unsigned型的key充当课程结点指向学生结点的指针**。因为通过课程结点已经能确定和学生结点的对应关系，**学生结点**想要快速寻找相关课程结点的地址无需采用4bytes的unsigned型存储课程结点的key，可以**保存课程结点在课程哈希表中的bucket数组的索引**，考虑到**unsigned short**可以存储0到65535的整数，而整个选课系统存储的课程数据往往不会超过这么多。就算课程数据量超过65535，只需要保证课程哈希表的bucket数组的容量不超过65536，unsigned short就可以表示其索引，只不过会因为哈希表装载因子增大而导致哈希冲突加剧，但是这点影响相对于其带来的优点显得非常小。
学生结点和课程结点都**以动态数组的方式存储上述的课程的选课学生的key信息以及学生的所选课程的bucket数组索引信息**。因此需要**额外引入一个int型记录动态数组内有几个元素**。关于数组扩容的问题，**课程结点保存选课学生的信息的动态数组的容量即为课程的容量**；而考虑到不同学生选课的数量差异很大，**学生保存选课信息的动态数组采用随时扩容，随时缩减的方式，缩减或扩容均以4个元素（8bytes）为单位**。
关于用户交互部分，本选课系统程序因为数据都保存在内存中，为了防止数据转移到硬盘前数据丢失，在编写该选课系统的用户交互部分时花了很多功夫增强程序的健壮性。
## 具体实现
见document\report.*